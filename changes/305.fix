Improve macOS support by removing small but critical bugs related to path handling
